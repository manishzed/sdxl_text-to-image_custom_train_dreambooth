# -*- coding: utf-8 -*-
"""text_to_image_custom_stableDiffusion_DreamBooth_vf_added_negativePrompt.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1P5Izp4HOvYWa33gktqccAZPcZM49DDK7
"""

!nvidia-smi

# Commented out IPython magic to ensure Python compatibility.
# %pip install autotrain-advanced==0.6.60

#!rm -rf /content/Dreambooth_SDXL

PROJECT_NAME = "Dreambooth_SDXL"
MODEL_NAME = "stabilityai/stable-diffusion-xl-base-1.0"
DATA_DIR = "/content/manish_photos"
REPO_ID = "kr-manish/text-to-image-sdxl-lora-manish"

from PIL import Image

def image_grid(imgs, rows, cols, resize=512):
    assert len(imgs) == rows * cols

    if resize is not None:
        imgs = [img.resize((resize, resize)) for img in imgs]

    w, h = imgs[0].size
    grid_w, grid_h = cols * w, rows * h
    grid = Image.new("RGB", size=(grid_w, grid_h))

    for i, img in enumerate(imgs):
        x = i % cols * w
        y = i // cols * h
        grid.paste(img, box=(x, y))

    return grid

import glob

imgs = [Image.open(path) for path in glob.glob("/content/manish_photos/*.png")]
len_img =len(imgs)
image_grid(imgs, 1, len_img)

from huggingface_hub import notebook_login
notebook_login()

#!rm -rf /content/manish_photos

!autotrain dreambooth \
--model $MODEL_NAME \
--project-name $PROJECT_NAME \
--image-path $DATA_DIR \
--prompt "photo of IshKuManish person in casual clothes, taking a selfie, and smiling." \
--resolution 1024 \
--batch-size 1 \
--num-steps 750 \
--gradient-accumulation 4 \
--lr 1e-4 \
--fp16 \
--gradient-checkpointing \
--push-to-hub \
--repo-id $REPO_ID

from diffusers import DiffusionPipeline, AutoencoderKL, StableDiffusionXLImg2ImgPipeline

import torch

vae = AutoencoderKL.from_pretrained(
    "madebyollin/sdxl-vae-fp16-fix",
    torch_dtype=torch.float16
)
pipe = DiffusionPipeline.from_pretrained(
    "stabilityai/stable-diffusion-xl-base-1.0",
    vae=vae,
    torch_dtype=torch.float16,
    variant="fp16",
    use_safetensors=True,
)
pipe.to("cuda");
#pipe.load_lora_weights(REPO_ID, weight_name="pytorch_lora_weights.safetensors")
#pipe.load_lora_weights("/content/Dreambooth_SDXL", weight_name="/content/Dreambooth_SDXL/pytorch_lora_weights.safetensors")
pipe.load_lora_weights("/content/Dreambooth_SDXL", weight_name="pytorch_lora_weights.safetensors")

prompt = "A photo of KuIsh23 participating in a marathon."

image = pipe(prompt=prompt, num_inference_steps=25, num_images_per_prompt = 3)
image_grid(image.images, 1, 3)

import gc
gc.collect()
torch.cuda.empty_cache()

#prompt = "A photo of manish kumar giving a press conference."
prompt = "A photo of KuIsh23 wearing a indian army clothes."

image = pipe(prompt=prompt, num_inference_steps=25, num_images_per_prompt = 3)
image_grid(image.images, 1, 3)

prompt = "A photo of KuIsh23 swimming in bikni."

seed = 42
generator = torch.Generator("cuda").manual_seed(seed)
image = pipe(prompt=prompt, num_inference_steps=25, generator=generator).images[0]
image.resize((512, 512))

#prompt = "A photo of KuIsh23 giving a press conference."
#prompt ="photo of a KuIsh23 person, participating in a high-energy dance performance."
#prompt ="Create a scene with KuIsh23 enjoying a sunny day at the beach."
#prompt ="Generate an image of KuIsh23 as a space explorer, discovering a new and vibrant alien world."
#prompt="Picture KuIsh23 as a fantasy realm monarch, ruling over a magical kingdom."
#prompt ="Imagine KuIsh23 as a time-traveling archaeologist uncovering ancient artifacts in a lost civilization."
#prompt ="Imagine KuIsh23 as a detective solving a mysterious case in a noir-inspired city."
#prompt ="Portrait of a KuIsh23 street performer in action with a bustling city as a blurred background."
#prompt ="Portrait of KuIsh23, an old fisherman at sea, using natural light to highlight weathered textures."
#prompt ="Joyful portrait of KuIsh23 laughing in the rain, using high shutter speed to freeze raindrops."
#prompt ="Black and white photograph of KuIsh23, a person dressed in 1920s fashion, posing against an old building."
#prompt ="Gentleman KuIsh23 Standing on a Luxurious Yacht with glass of wine and girl."
#prompt ="Gentleman KuIsh23 and a companion are delighting in the luxurious experience aboard a lavish yacht."
#prompt ="Mesmerizing Portrait of KuIsh23 as portraying Sherlock Holmes."
#prompt ="Captivating Portrait of KuIsh23 as the Legendary Iron Man, Robert Downey Jr."
#prompt ="classic KuIsh23 british man with glass of whisky."
#prompt =" Portrait of KuIsh23, a Death Metal Artist."
#prompt ="Generate an image of KuIsh23 in new york times square"
#prompt ="KuIsh23 is a 90-year-old man living in a farming village."
#prompt ="photo of KuIsh23 with sexy look with blur background."
#prompt ="photo of KuIsh23 with classic and decent look."
#prompt ="KuIsh23 on couch with crossed arms."
#prompt ="KuIsh23 riding a horse."
prompt="photo of KuIsh23 in a neaon-lit cyberpunk cityscape, 4k resolution, with holographic advertisements surrounding him."
image = pipe(prompt=prompt, num_inference_steps=25,num_images_per_prompt = 3)
image_grid(image.images, 1, 3)

#prompt = "A photo of KuIsh23 giving a press conference."
#prompt ="photo of a KuIsh23 person, participating in a high-energy dance performance."
#prompt ="Create a scene with KuIsh23 enjoying a sunny day at the beach."
#prompt ="Generate an image of KuIsh23 as a space explorer, discovering a new and vibrant alien world."
#prompt="Picture KuIsh23 as a fantasy realm monarch, ruling over a magical kingdom."
#prompt ="Imagine KuIsh23 as a time-traveling archaeologist uncovering ancient artifacts in a lost civilization."
#prompt ="Imagine KuIsh23 as a detective solving a mysterious case in a noir-inspired city."
#prompt ="Portrait of a KuIsh23 street performer in action with a bustling city as a blurred background."
#prompt ="Portrait of KuIsh23, an old fisherman at sea, using natural light to highlight weathered textures."
#prompt ="Joyful portrait of KuIsh23 laughing in the rain, using high shutter speed to freeze raindrops."
#prompt ="Black and white photograph of KuIsh23, a person dressed in 1920s fashion, posing against an old building."
#prompt ="Gentleman KuIsh23 Standing on a Luxurious Yacht with glass of wine and girl."
#prompt ="Gentleman KuIsh23 and a companion are delighting in the luxurious experience aboard a lavish yacht."
#prompt ="Mesmerizing Portrait of KuIsh23 as portraying Sherlock Holmes."
#prompt ="Captivating Portrait of KuIsh23 as the Legendary Iron Man, Robert Downey Jr."
#prompt ="classic KuIsh23 british man with glass of whisky."
#prompt =" Portrait of KuIsh23, a Death Metal Artist."
#prompt ="Generate an image of KuIsh23 in new york times square"
#prompt ="KuIsh23 is a 90-year-old man living in a farming village."
#prompt ="photo of KuIsh23 with sexy look with blur background."
#prompt ="photo of KuIsh23 with classic and decent look."
prompt ="photo of KuIsh23 on couch with crossed arms."
#prompt ="KuIsh23 riding a horse."
#prompt="photo of KuIsh23 in a neaon-lit cyberpunk cityscape, 4k resolution, with holographic advertisements surrounding him."
#image = pipe(prompt=prompt, num_inference_steps=25,num_images_per_prompt = 3)
#image_grid(image.images, 1, 3)

#negative_prompt ="deformed, blurry, bad anatomy, disfigured face, mutation,out of frame, lowres, text, error, cropped, worst quality, low quality, jpeg artifacts, ugly, duplicate, morbid, mutilated, out of frame, extra fingers, mutated hands, poorly drawn hands, poorly drawn face, mutation, deformed, blurry, dehydrated, bad anatomy, bad proportions, extra limbs, cloned face, disfigured, gross proportions, malformed limbs, missing arms, missing legs, extra arms, extra legs, fused fingers, too many fingers, long neck, username, watermark, signature"
#negative_prompt ="Deformed, blurry, bad anatomy, disfigured face, mutation, extra limb, ugly, poorly drawn hands, fused fingers, messy drawing, broken legs, censor bar, multiple breasts, mutated hands and fingers, long body, black-and-white, liquid body, anatomical nonsense, error, malformed hands, long neck, low resolution, bad proportions, bad shadow, unnatural body, fused breasts, huge breasts, disappearing limbs, fused ears, poorly drawn ears, extra ears."
#negative_prompt ="Pixelated, pixel distortion, excessive noise, over-saturation, lack of depth, inconsistent lighting, unnatural colors, awkward poses, awkward composition, lack of perspective, unclear focus, awkward expressions, misaligned features, poor shading, unrealistic shadows, overuse of filters, improper blending, lack of details, inconsistent style, lack of cohesion, confusing elements, distracting background, cluttered layout, improper use of gradients, awkward anatomy, incorrect lighting direction, unconvincing textures, bland color palette, overuse of flashy effects, lack of originality, unbalanced symmetry, awkward symmetry, lack of dynamics, disproportionate body parts, inconsistent line work, unnatural facial expressions, distracting patterns, confusing visual hierarchy, unrefined linework, messy linework, lack of finesse, overuse of lens flares, overuse of blur effects, lack of storytelling, lack of emotion, overreliance on presets, unclear focal point, disjointed elements"
#negative_prompt ="Amputee, Autograph, Bad anatomy, Bad illustration, Bad proportions, Beyond the borders, Blank background, Blurry, Body out of frame, Boring background, Branding, Cropped, Cut off, Deformed, Disfigured, Dismembered, Disproportioned, Distorted, Draft, Duplicate, Duplicated features, Extra arms, Extra fingers, Extra hands, Extra legs, Extra limbs, Fault, Flaw, Fused fingers, Grains, Grainy, Gross proportions, Hazy, Identifying mark, Improper scale, Incorrect physiology, Incorrect ratio, Indistinct, Kitsch, Logo, Long neck, Low quality, Low resolution, Macabre, Malformed, Mark, Misshapen, Missing arms, Missing fingers, Missing hands, Missing legs, Mistake, Morbid, Mutated hands, Mutation, Mutilated, Off-screen, Out of frame, Outside the picture, Pixelated, Poorly drawn face, Poorly drawn feet, Poorly drawn hands, Printed words, Render, Repellent, Replicate, Reproduce, Revolting dimensions, Script, Shortened, Sign, Signature, Split image, Squint, Storyboard, Text, Tiling, Trimmed, Ugly, Unfocused, Unattractive, Unnatural pose, Unreal Engine, Unsightly, Watermark, Written language"
#negative_prompt ="(((deformed))), blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), fused fingers, messy drawing, broken legs censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquidtongue, disfigured, malformed, mutated, anatomical nonsense, text font ui, error, malformed hands, long neck, blurred, lowers, low res, bad anatomy, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missingbreasts, huge haunch, huge thighs, huge calf, bad hands, fused hand, missing hand, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fusedears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears, old photo, low res, black and white, black and white filter, colorless, (((deformed))), blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), fused fingers, messy drawing, broken legs censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquid tongue, disfigured, malformed, mutated, anatomical nonsense, text font ui, error, malformed hands, long neck, blurred, lowers, low res, bad anatomy, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missing breasts, huge haunch, huge thighs, huge calf, bad hands, fused hand, missing hand, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears, old photo, low res, black and white, black and white filter, colorless, (((deformed))), blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), fused fingers, messy drawing, broken legs censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquid tongue, disfigured, malformed, mutated, anatomical nonsense, text font ui, error, malformed hands, long neck, blurred, lowers, low res, bad anatomy, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missing breasts, huge haunch, huge thighs, huge calf, bad hands, fused hand, missing hand, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears, (((deformed))), blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), fused fingers, messy drawing, broken legs censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquidtongue, disfigured, malformed, mutated, anatomical nonsense, text font ui, error, malformed hands, long neck, blurred, lowers, low res, bad anatomy, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missingbreasts, huge haunch, huge thighs, huge calf, bad hands, fused hand, missing hand, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fusedears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears"

#negative_prompt ="Blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), irregular fingers, messy drawing, broken legs, censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquid tongue, disfigured, malformed, mutated, anatomical nonsense, text font UI, error, malformed hands, long neck, blurred, low res, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missing breasts, huge haunch, huge thighs, huge calf, malformed hands, irregular fingers, bad hands, fused hand, missing hand, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears, malformed fingers, irregular hand shapes, distorted fingers, hand deformities, finger abnormalities, hand mutations, extra or irregular fingers, deformed finger structures"
negative_prompt ="deformed,blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), inconsistent finger proportions, messy drawing, broken legs, censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquid tongue, disfigured, malformed, mutated, anatomical nonsense, text font UI, error, malformed hands, long neck, blurred, low res, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missing breasts, huge haunch, huge thighs, huge calf, irregular hand shapes, distorted fingers, hand deformities, finger abnormalities, hand mutations, extra or irregular fingers, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears"
#negative_prompt ="deformed,blurry, bad anatomy, disfigured, poorly drawn face, distorted hands,hand and finger irregularities,distorted hand,hands and fingers irregularities,mutation, mutated, (extra_limb), (ugly), (poorly drawn hands), inconsistent finger proportions, messy drawing, broken legs, censor, censored, censor_bar, multiple breasts, (mutated hands and fingers:1.5), (long body :1.3), (mutation, poorly drawn :1.2), black-white, bad anatomy, liquid body, liquid tongue, disfigured, malformed, mutated, anatomical nonsense, text font UI, error, malformed hands, long neck, blurred, low res, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, heavy breasts, missing breasts, huge haunch, huge thighs, huge calf, irregular hand shapes, distorted fingers, hand deformities, finger abnormalities, hand mutations, extra or irregular fingers, disappearing arms, disappearing thigh, disappearing calf, disappearing legs, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears"
########
#negative_prompt ="Distorted composition, obscured details, anatomical inconsistencies, facial aberrations, genetic anomalies, beyond the frame, suboptimal resolution, textual interference, technical errors, improper cropping, lowest quality, JPEG artifacts, aesthetically unpleasing, duplication issues, morbid aesthetics, mutilated depiction, unconventional framing, supernumerary digits, mutated appendages, inadequately drawn hands, facial deformities, mutational distortions, dehydrated portrayal, anatomical inaccuracies, proportions gone awry, surplus limbs, replicated visage, disfigurement, grossly disproportionate, malformed extremities, absent arms or legs, supernumerary extremities, fused digits, excessive fingers, elongated neck, identity markers (username, watermark, signature), liquidized portrayal, anatomical absurdities, shadow discrepancies, unnatural body form, broken anatomy, censoring elements, unconventional breast arrangement, disproportionate size, disappearing or fused limbs, elongated body structure, monochromatic rendering, liquid-like physique, anatomical incongruities, technical malfunctions, malformed hands, unnatural elongation, low-resolution shadows, incongruent body structure, fused auditory organs, poorly rendered ears, supernumerary ears"
#negative_prompt ="Deformed, blurry, bad anatomy, disfigured face, mutation, out of frame, low resolution, textual interference, cropping issues, worst quality, low quality, JPEG artifacts, visually unappealing, duplication problems, morbid aesthetics, mutilated depiction, unconventional framing, extra or mutated fingers, mutated hands, poorly drawn hands, poorly drawn face, facial details lacking, anatomical distortions, dehydrated portrayal, anatomical inaccuracies, proportions gone awry, surplus limbs, cloned face, facial disfigurement, gross proportions, malformed limbs, absence of arms or legs, additional arms, extra legs, fused fingers, excessive fingers, elongated neck, identity markers (username, watermark, signature), poorly rendered face, poorly drawn face, extra or mutated fingers, poorly drawn legs, poorly rendered legs, extra or mutated limbs, low resolution, images cut off at the top, left, right, bottom, composition flaws, mutated body parts, blurred image, oversaturation, deformed body features"
image = pipe(prompt=prompt, num_inference_steps=25, num_images_per_prompt = 3, negative_prompt=negative_prompt)
image_grid(image.images, 1, 3)

refiner = StableDiffusionXLImg2ImgPipeline.from_pretrained(
    "stabilityai/stable-diffusion-xl-refiner-1.0",
    vae=vae,
    torch_dtype=torch.float16,
    use_safetensors=True,
    variant="fp16",
)
refiner.to("cuda");

image = refiner(prompt=prompt, num_inference_steps=25, generator=generator, image=image)
image.images[0].resize((300, 300))

from google.colab import drive
drive.mount('/content/gdrive')
!ln -s /content/gdrive/My\ Drive/ /mydrive
!ls /mydrive

!cp -r /content/gdrive/MyDrive/text-to-image_sdxl_DreamBooth_custom/Dreambooth_SDXL_750_v4 /content

